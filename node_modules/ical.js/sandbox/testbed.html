<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/.
   - Portions Copyright (C) Philipp Kewisch, 2012 -->

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="../build/ical.js"></script>
    <script type="text/javascript" src="testbed/ace.js"></script>
    <script type="text/javascript">
      window.addEventListener("load", function() {
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/kr");
        editor.getSession().setMode("ace/mode/javascript");

        var input = ace.edit("input");
        input.setTheme("ace/theme/kr");
        input.getSession().setMode("ace/mode/ical");

        var savedIcalData = window.localStorage.getItem("icaldata");
        if (savedIcalData) input.getSession().setValue(savedIcalData);

        var savedJsData = window.localStorage.getItem("jsdata");
        if (savedJsData) editor.getSession().setValue(savedJsData);

        var executeCommand = {
            name: "execute",
            bindKey: { win: "Ctrl-Enter", mac: "Command-Enter" },
            exec: doEval,
        };
        editor.commands.addCommand(executeCommand);
        input.commands.addCommand(executeCommand);
      }, false);

      window.addEventListener("beforeunload", function() {
        var input = ace.edit("input");
        var ical = input.getValue();

        var editor = ace.edit("editor");
        var js = editor.getValue();

        window.localStorage.setItem("icaldata", ical);
        window.localStorage.setItem("jsdata", js);
      }, false);

      function doEval() {
        var input = ace.edit("input");
        var ical = input.getValue();

        var editor = ace.edit("editor");
        var js = editor.getValue();

        // Note: This is UNSAFE, only for local use
        if (window.location.protocol == "file:") {
          var f = new Function("input", js);
          f(ICAL.parse(ical));
        } else {
          alert("This code is unsafe for " + window.location.protocol +
                "//, please access via file://");
        }
      }
    </script>
  </head>
  <body>
    <h1>ICAL.js Sandbox</h1>
    <code id="preinput" class="ace-tm"><span class="ace_storage ace_type">var</span> input = ICAL.parse(</code>
    <table style="width: 100%; height: 80%;">
      <tr>
        <td><pre id="input" style="height: 100%">BEGIN:VCALENDAR
PRODID:-//xyz Corp//NONSGML PDA Calendar Version 1.0//EN
VERSION:2.0
BEGIN:VEVENT
DTSTAMP:19960704T120000Z
UID:uid1@example.com
ORGANIZER:mailto:jsmith@example.com
DTSTART:19960918T143000Z
DTEND:19960920T220000Z
STATUS:CONFIRMED
CATEGORIES:CONFERENCE
SUMMARY:Networld+Interop Conference
DESCRIPTION:Networld+Interop Conference
  and Exhibit\nAtlanta World Congress Center\n
 Atlanta\, Georgia
END:VEVENT
END:VCALENDAR</pre></td>
        <td><pre id="editor" style="height: 100%;">
alert(input);</pre></td>
      </tr>
    </table>
    <code>);</code>
    <input type="button" onclick="doEval()" value="Evaluate"/>
  </body>
</html>
